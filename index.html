<!DOCTYPE html>
<html>
  <head>
    <title>MovieTube (TV)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Estilo para asegurar que el iframe no tenga bordes */
      .reproductor-iframe {
        border: none;
      }
      /* Estilo base para el Hero Banner (se sobrescribe dinámicamente) */
      .hero-background {
          background-size: cover;
          background-position: center;
      }
      /* Estilo para mejorar el foco en TV (D-Pad) */
      .focus\:ring-4:focus {
        outline: none;
      }
      /* Estilo para truncar títulos a dos líneas y mantener altura uniforme */
      .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
          /* Altura máxima aproximada para 2 líneas de texto "text-lg" */
          max-height: 3rem; 
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white min-h-screen">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      // ----------------------------------------------------------------------
      // LÓGICA DE CONVERSIÓN DE URL Y EXTRACCIÓN DE ID
      // ----------------------------------------------------------------------

      // Función para obtener el ID, la URL de incrustación, la URL de la miniatura y el tipo de fuente
      function obtenerVideoInfo(url) {
          const defaultVideoId = 'dQw4w9WgXcQ'; // ID por defecto (Rick Roll)
          let videoId = defaultVideoId;
          let isYouTube = false;

          if (url) {
              const youtubeRegex = /(?:youtube\.com|youtu\.be)\/(?:v=|embed\/|watch\?v=|\/v\/)?([a-zA-Z0-9_-]{11})/;
              const match = url.match(youtubeRegex);

              if (match && match[1]) {
                  videoId = match[1];
                  isYouTube = true;
              }
          }

          if (isYouTube) {
              // Parámetros de YouTube: autoplay y mute para mejorar compatibilidad, pero con controls
              const urlEmbed = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=1`;
              const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`; 
              return { videoId, urlEmbed, thumbnailUrl, isYouTube };
          } else {
              let urlEmbed = url; 
              if (!url.toLowerCase().match(/\.(mp4|webm|ogg)$/)) {
                 const separator = url.includes('?') ? '&' : '?';
                 urlEmbed = `${url}${separator}autoplay=1`;
              }
              const thumbnailUrl = "https://placehold.co/1920x1080/1F2937/fff?text=VIDEO+EXTERNO"; 
              return { videoId: null, urlEmbed, thumbnailUrl, isYouTube: false };
          }
      }


      // ----------------------------------------------------------------------
      // COMPONENTES PRINCIPALES
      // ----------------------------------------------------------------------

      // Muestra el reproductor a pantalla completa cuando el usuario selecciona un video.
      function ReproductorEnFoco({ videoUrl, onBack }) {
          const { urlEmbed } = obtenerVideoInfo(videoUrl);
          
          // Referencia para el iframe y para el botón de Volver
          const iframeRef = React.useRef(null); 
          const backButtonRef = React.useRef(null);

          React.useEffect(() => {
              // Al montar, forzamos el foco al iframe/contenedor
              if (iframeRef.current) {
                  iframeRef.current.focus(); 
              }
              
              // Función para manejar la tecla ESC y el D-Pad "Atrás"
              const handleKeyDown = (event) => {
                  if (event.key === 'Escape') {
                      onBack();
                  }
              };
              document.addEventListener('keydown', handleKeyDown);
              return () => {
                  document.removeEventListener('keydown', handleKeyDown);
              };
          }, [onBack]);


          return (
              <div className="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center">
                  {/* Botón Volver - Usaremos la ref para el foco de vuelta */}
                  <button 
                      ref={backButtonRef}
                      id="back-button"
                      onClick={onBack}
                      className="absolute top-4 left-4 p-3 bg-gray-700 text-white rounded-full text-lg z-50 
                                transition-all hover:bg-gray-600 
                                focus:ring-4 focus:ring-red-500 focus:outline-none"
                      tabIndex="0" // Enfocable con control remoto
                  >
                      {/* Icono de flecha (SVG) */}
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                      </svg>
                  </button>

                  {/* Contenedor responsivo 16:9 para el iframe */}
                  <div className="w-full h-full p-4 flex items-center justify-center">
                      <div className="aspect-video w-full max-w-screen-xl">
                          <iframe
                          // Asignar la referencia al iframe
                          ref={iframeRef} 
                          // Hacer el iframe enfocable
                          tabIndex="0"
                          className="reproductor-iframe w-full h-full rounded-xl shadow-2xl"
                          src={urlEmbed}
                          title="Video en Foco"
                          // Permisos para reproducir videos y usar controles
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
                          allowFullScreen
                          ></iframe>
                      </div>
                  </div>
              </div>
          );
      }


      // COMPONENTE HERO BANNER
      const HeroBanner = React.forwardRef(({ titulo, descripcion, videoUrl, onPlay }, ref) => {
          const { thumbnailUrl } = obtenerVideoInfo(videoUrl);

          return (
              <div 
                  className="hero-background w-full min-h-[50vh] flex items-end relative overflow-hidden mb-10 rounded-xl shadow-2xl"
                  tabIndex="-1" 
                  style={{ backgroundImage: `url('${thumbnailUrl}'), url('https://placehold.co/1920x1080/0d1117/333?text=CARGANDO...')` }}
              >
                  {/* Capa de contraste oscuro */}
                  <div className="absolute inset-0 bg-black/60"></div>

                  {/* Contenido del Banner */}
                  <div className="relative p-10 max-w-xl">
                      <h2 className="text-5xl font-extrabold mb-3 text-white drop-shadow-lg">
                          {titulo}
                      </h2>
                      <p className="text-lg mb-6 text-gray-200 drop-shadow-md">
                          {descripcion}
                      </p>

                      {/* Botón de acción con la referencia para el foco */}
                      <button 
                          ref={ref} // <--- REFERENCIA ASIGNADA AQUÍ
                          onClick={() => onPlay(videoUrl)} 
                          className="inline-block px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg 
                                  transition-all duration-300 hover:bg-red-700 
                                  focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-900 focus:outline-none"
                          tabIndex="0" 
                      >
                          Ver Ahora
                      </button>
                  </div>
              </div>
          );
      });
      // Aseguramos que el componente tenga un nombre para debugging
      HeroBanner.displayName = 'HeroBanner';


      // COMPONENTE TARJETA DE VIDEO (En la lista)
      function ReproductorDeVideo(props) {
        const { videoId, thumbnailUrl, isYouTube } = obtenerVideoInfo(props.url);
        const genericPlaceholderUrl = "https://placehold.co/600x337/333/fff?text=VIDEO+EXTERNO";

        const handleImageError = (e) => {
            e.target.onerror = null; 
            if (isYouTube && videoId && e.target.src.includes('maxresdefault')) {
                e.target.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                return;
            } 
            e.target.src = genericPlaceholderUrl;
        };

        return (
          <div 
            className="video-card cursor-pointer group relative overflow-hidden bg-gray-800 rounded-xl shadow-lg 
                        transition-all duration-300 hover:shadow-2xl hover:scale-[1.05] 
                        focus:ring-4 focus:ring-red-500 focus:outline-none"
            onClick={() => props.onPlay(props.url)} 
            tabIndex="0" 
          >
            <img 
                src={thumbnailUrl} 
                onError={handleImageError} 
                className="w-full aspect-video object-cover transition duration-500 group-hover:opacity-75"
                alt={`Miniatura de ${props.titulo}`}
            />

            <div className="p-4">
              <h2 className="text-lg font-semibold text-red-400 group-focus:text-red-300 line-clamp-2">
                {props.titulo || "Título del Video"}
              </h2>
              <p className="mt-1 text-gray-400 text-sm">
                Fuente: {isYouTube ? "YouTube" : "Externa"}
              </p>
            </div>

          </div>
        );
      }

      // COMPONENTE PRINCIPAL DE LA APLICACIÓN (Maneja el estado)
      function App() {
          const [videoEnFocoUrl, setVideoEnFocoUrl] = React.useState(null);
          // Referencia para el botón al que queremos volver el foco
          const heroButtonRef = React.useRef(null); 

          // Función mejorada para volver a la lista y REENFOCAR
          const handleBack = React.useCallback(() => {
              setVideoEnFocoUrl(null);
              // Al volver al menú principal, forzamos el foco al botón "Ver Ahora" del Hero Banner.
              // Usamos un pequeño timeout para asegurar que el DOM se haya renderizado antes de enfocar.
              setTimeout(() => {
                  if (heroButtonRef.current) {
                      heroButtonRef.current.focus();
                  }
              }, 0);
          }, []);


          if (videoEnFocoUrl) {
              return <ReproductorEnFoco 
                  videoUrl={videoEnFocoUrl} 
                  onBack={handleBack} 
              />;
          }

          const heroVideoUrl ="https://youtu.be/GwPAvxA62Do?si=aK5qDPYMPfpkTS8o";

          return (
              <div className="p-4 md:p-8 max-w-7xl mx-auto">
                  {/* HERO BANNER - Pasamos la referencia para que su botón sea enfocable */}
                  <HeroBanner 
                      ref={heroButtonRef} // <--- PASAMOS LA REFERENCIA
                      titulo="Estreno de la Semana"
                      descripcion="No te pierdas el documental más aclamado sobre la vida en Marte y su colonización."
                      videoUrl={heroVideoUrl}
                      onPlay={setVideoEnFocoUrl} 
                  />

                  <h1 className="text-3xl font-bold mb-6 text-red-600">
                      Explorar Videos
                  </h1>

                  {/* LISTA DE VIDEOS (GRID) */}
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <ReproductorDeVideo titulo="Documental de Marte" url={heroVideoUrl} onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Trailer de Película" url="https://youtu.be/9eGzFLWuSmY?si=cGpQoCGegKj2LI2k" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Tutorial de React JS" url="https://youtu.be/epUe_LPcq-k?si=8dmditU-6Y2ieEd" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Tecnología 2025: Un vistazo al futuro" url="https://youtu.be/P59WtHvSd18?si=Qz-lcl-a1MrNU5b8" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Clásico de los 80s (Música)" url="https://youtu.be/T8SYLvGEBkk?si=4QnLS9WPwQu4cQgo" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Viaje por la Galaxia" url="https://youtu.be/chmuJSP-V8Y?si=YHCUZ3fSuhpIGqNg" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Entrevista a Chef Famoso" url="https://youtu.be/9eGzFLWuSmY?si=cGpQoCGegKj2LI2k" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="Recetas Rápidas" url="https://youtu.be/gwkUDXSGbxg?si=eLcpoLsvJP6kr7d2" onPlay={setVideoEnFocoUrl} />
                    <ReproductorDeVideo titulo="El Misterio del Lago" url="https://youtu.be/qYfJ36XxEpc?si=_SicDPM0kU8WR_AY" onPlay={setVideoEnFocoUrl} />
                  </div>
              </div>
          );
      }

      // 7. MONTAJE DE LA APLICACIÓN
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    </script>
  </body>
</html>
